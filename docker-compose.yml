version: '3.8'

services:
  # 監視システム本体のコンテナ設定
  2st-monitor:
    # Dockerfileを使ってカスタムイメージをビルドする
    build:
      context: .
      dockerfile: Dockerfile.monitor
    
    # コンテナ名（識別しやすくするため）
    container_name: 2st-monitor
    
    # 常に再起動する設定（システムがクラッシュしても自動復旧）
    restart: always
    
    # 環境変数を .env ファイルから読み込む
    env_file:
      - .env
      
    # 永続化が必要なデータファイルをホストのディレクトリと同期
    volumes:
      # スナップショットデータと統計データ
      - ./2st_snapshot.json:/app/2st_snapshot.json
      - ./2st_stats.json:/app/2st_stats.json
      # Playwrightが使用するキャッシュをホスト側に保存（初回起動高速化）
      - ./node_modules:/app/node_modules
    
    # 起動コマンド (npm start は node 2st-monitor.js を実行)
    command: npm start

# ボリュームは使用しませんが、networksの指定があれば追加可能です
# networks:
#   - default